<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>게시물 수정</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"/>
</head>
<body class="container py-4  mt-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">
      <h2 class="mb-4">게시물 수정</h2>
      <form id="editForm" class="mb-3">
<!--    <div class="form-group">-->
<!--      <label for="editId">게시물 ID</label>-->
<!--      <input type="number" id="editId" name="editId" class="form-control" required/>-->
<!--    </div>-->
    <div class="form-group">
      <label for="editTitle">제목</label>
      <input type="text" id="editTitle" name="editTitle" class="form-control" required/>
    </div>
    <div class="form-group">
      <label for="editContent">내용</label>
      <textarea id="editContent" name="editContent" class="form-control" required   style="height: 300px"></textarea>
    </div>
    <div class="form-group">
      <label for="editPassword">비밀번호</label>
      <input type="password" id="editPassword" name="editPassword" class="form-control" required/>
    </div>
    <button type="submit" class="btn btn-primary">게시물 수정하기</button>
  </form>
    </div>
  </div>
</body>
<script src="/js/common.js"></script>
<script>
  // const postId       = document.getElementById("editId").value.trim();
  const postId       = new URLSearchParams(location.search).get("postId").trim();

  if(!postId || postId === "") {
    throw new Error("게시물 ID가 존재하지 않습니다.");
  }

  const $editTitle    = document.getElementById("editTitle");
  const $editContent  = document.getElementById("editContent");
  const $editPassword = document.getElementById("editPassword");
  const $editForm     = document.getElementById("editForm");


  // 기존 게시글 데이터 세팅
  async function loadBoardPost() {
      const response = await ApiUtil.get(`/api/board/${postId}`);
      $editTitle.value   = response?.title;
      $editContent.value = response?.content;
  }

  // 폼 수정 핸들러
  async function editFormHandler(e) {
      e.preventDefault();

      const title    = $editTitle.value.trim();
      const content  = $editContent.value.trim();
      const password = $editPassword.value.trim();

      // if (!ValidationUtil.isNotEmpty(postId)) {
      //   AlertUtil.showWarning("게시물 ID를 입력해주세요");
      //   return;
      // }
      if (!ValidationUtil.isNotEmpty(title)) {
          AlertUtil.showWarning("제목을 입력해주세요");
          return;
      }
      if (!ValidationUtil.isNotEmpty(content)) {
          AlertUtil.showWarning("내용을 입력해주세요");
          return;
      }
      if (!ValidationUtil.isNotEmpty(password)) {
          AlertUtil.showWarning("비밀번호를 입력해주세요");
          return;
      }

      const confirmed = await AlertUtil.showConfirm("정말로 수정하시겠습니까?");
      if (!confirmed) return;

      ApiUtil.put(`/api/board/${postId}`, {
            title
          , content
          , password
      })
          .then(data => {
              if(data) {
                  location.href="board_list.html";
              }
          })
          .catch(() => {
              console.log("API 호출 실패");
          });
  }

  document.addEventListener("DOMContentLoaded", () => {
      // common.js 호출 이후 실행되도록
      setTimeout(loadBoardPost, 100);
      $editForm.addEventListener("submit", editFormHandler);
  });

</script>
</html> 