<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내 게시글 목록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="mb-4">내 게시글</h2>
    <div id="postList"></div>
    <div class="mt-3">
        <button class="btn btn-secondary" onclick="goBack()">← 돌아가기</button>
    </div>
</div>

<script src="/js/common.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function goBack() {
      history.back();
    }

    async function loadUserPosts() {
      const userId = new URLSearchParams(location.search).get("userId");

      // userId가 없을 경우 "전체 게시글 목록"으로 변경
      document.title = userId ? "내 게시글 목록" : "전체 게시글 목록";
      document.querySelector("h2").innerText = userId ? "내 게시글" : "전체 게시글";

      let url;
      if (!userId || userId === "null") {
        // userId가 없을 경우: 전체 게시글 조회
        url = "/board/all";
      } else {
        // userId가 있을 경우: 해당 사용자의 게시글만 조회
        url = `/board/user/${userId}`; // ← 백틱 사용
      }

      const res = await fetch(url);
      const result = await res.json();
      if (result.code !== 'SUCCESS') {
        alert("게시글을 불러오지 못했습니다.");
        return;
      }

      const posts = result.data;
      if (!posts.length) {
        document.getElementById("postList").innerHTML =
          "<div class='alert alert-info'>작성한 게시글이 없습니다.</div>";
        return;
      }

      let html = "<ul class='list-group'>";
      for (const post of posts) {
        html += `
          <li class='list-group-item'>
            <a href="board_detail.html?uuid=${post.uuid}" class="text-decoration-none">
              <div class="fw-bold mb-1">${post.title}</div>
              <div class="mb-1 text-truncate">${post.content}</div>
              <div class="text-muted small">작성일: ${post.createdAt}</div>
            </a>
          </li>
        `;
      }
      html += "</ul>";
      document.getElementById("postList").innerHTML = html;
    }

    document.addEventListener("DOMContentLoaded", loadUserPosts);
</script>
</body>
</html>
