<!DOCTYPE html>
<html lang                  = "ko">
<head>
    <meta charset           = "UTF-8">
    <title>게시글 상세</title>
    <link href              = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class                 = "bg-light">
<div class                  = "container py-5">
    <h2 class               = "mb-4">게시글 상세</h2>

    <div id                 = "postDetail" class="card shadow-sm mb-4"></div>
    <div class              = "d-flex justify-content-between">
        <button class       = "btn btn-secondary" onclick="history.back()">← 목록으로</button>
        <div class          = "d-flex gap-2">
            <button class   = "btn btn-warning" id="editBtn">수정</button>
            <button class   = "btn btn-danger" id="deleteBtn">삭제</button>
        </div>
    </div>

</div>
</div>

<script src                 = "/js/common.js"></script>
<script src                 = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    async function loadPostDetail() {
      const uuid            = new URLSearchParams(location.search).get("uuid");
      if (!uuid) {
        alert("게시글 ID(uuid)가 없습니다.");
        return;
      }
      const res             = await fetch(`/board/detail/${uuid}`);
      const result          = await res.json();
      if (result.code !== 'SUCCESS') {
        alert("게시글을 불러오지 못했습니다.");
        return;
      }
      const post            = result.data;
      const html            = `
        <div class          = "card-body">
          <h3 class         = "card-title mb-3">${post.title}</h3>
          <p class          = "card-text">${post.content}</p>
          <div class        = "text-muted small mb-1">작성자: ${post.userId}</div>
          <div class        = "text-muted small">작성일: ${post.createdAt}</div>
          <div class        = "text-muted small">수정일: ${post.updatedAt || '-'}</div>
        </div>
      `;
      document.getElementById("postDetail").innerHTML = html;
    }
    document.addEventListener("DOMContentLoaded", loadPostDetail);

    document.addEventListener("DOMContentLoaded", () => {
  loadPostDetail();

  document.getElementById("deleteBtn").addEventListener("click", async () => {
    const uuid              = new URLSearchParams(location.search).get("uuid");
    const ok                = await AlertUtil.showConfirm("정말 삭제하시겠습니까?");
    if (!ok) return;

    const res = await fetch(`/board/delete?uuid=${uuid}`, {
      method                : "DELETE"
    });
    const result            = await res.json();
    if (result.success) {
      await AlertUtil.showSuccess("삭제되었습니다.");
      history.back(); // 목록 페이지 경로
    } else {
      AlertUtil.showError("삭제 실패");
    }
  });

  document.getElementById("editBtn").addEventListener("click", () => {
    const uuid              = new URLSearchParams(location.search).get("uuid");
    location.href           = `/board/edit.html?uuid=${uuid}`;
  });
});

</script>
</body>
</html>
