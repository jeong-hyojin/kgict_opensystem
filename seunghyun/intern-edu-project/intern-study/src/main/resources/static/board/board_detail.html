<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>게시글 상세</title>
</head>
<body class="container p-4">
<h2>게시글 상세</h2>
<div id="boardInfo" class="border p-3 bg-light">게시글 내용</div>

<div class="mt-3">
  <button class="btn btn-secondary" onclick="goBack()">돌아가기</button>
  <button class = "btn btn-primary" onclick="goUpdate()">수정하기</button>
  <button class = "btn btn-danger" onclick="goDelete()">삭제하기</button>
  <button class="btn btn-outline-danger float-right" onclick="logout()">로그아웃</button>
</div>

</body>

<script src="/js/common.js"></script>
<script>
  // 뒤로 가기
  function goBack() {
    history.back();
  }

  //게시글 수정하기
  function goUpdate(){
    const id = new URLSearchParams(location.search).get("id");
    location.href = `board_update.html?id=${id}`;
  }

  //게시글 삭제하기
  async function goDelete(){
    const id = new URLSearchParams(location.search).get("id");

    // ApiUtil.del 요청 (PathVariable 방식)
    const result = await ApiUtil.del(`/api/boards/delete/${id}`);

    // ApiUtil.del 요청 (RequestParam 방식)
    //const result = await ApiUtil.del("/api/boards/delete", { params: { id: id } });

    location.href = "board_list.html";
  }

  // 로그아웃 처리 (세션 제거는 서버에서, 여기선 로컬 스토리지만)
  function logout() {
    localStorage.clear();
    location.href = "/login.html";
  }

  // 사용자 정보 조회
  async function loadBoardInfo() {
    const boardId = new URLSearchParams(location.search).get("id");
    const board = await ApiUtil.get(`/api/boards/${boardId}`);
    //console.log(board)
    if (!board) return; // ApiUtil 내부에서 showError 처리됨

    const html = `
      <div><strong>게시글 번호</strong> : ${board.id}</div>
      <div><strong>게시글 UUID</strong> : ${board.uuid}</div>
      <div><strong>제목</strong> : ${board.title}</div>
      <div><strong>내용</strong> : ${board.content}</div>
      <div><strong>작성 시간</strong> : ${board.createdDate}</div>
      <div><strong>수정 시간</strong> : ${board.updatedDate}</div>
    `;

    document.getElementById("boardInfo").innerHTML = html;
  }

  document.addEventListener("DOMContentLoaded", function () {
    // common.js 호출 이후 실행되도록
    setTimeout(loadBoardInfo, 100);
  });

</script>
</html>